<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>双人火柴人对战（落石 + 子弹）</title>
<style>
    body {
        margin: 0;
        background: #111827;
        overflow: hidden;
        color: white;
        font-family: Arial;
        text-align: center;
    }

    #game {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: radial-gradient(circle at center, #1f2937, #0f172a);
        overflow: hidden;
    }

    .player {
        position: absolute;
        width: 20px;
        height: 60px;
    }

    /* 火柴人身体 */
    .player::after {
        content: "";
        position: absolute;
        width: 4px;
        height: 55px;
        background: white;
        left: 8px;
    }

    /* 火柴人头 */
    .player::before {
        content: "";
        position: absolute;
        width: 12px;
        height: 12px;
        background: white;
        border-radius: 50%;
        top: -12px;
        left: 4px;
    }

    /* 子弹 */
    .bullet {
        position: absolute;
        width: 10px;
        height: 4px;
        background: yellow;
        border-radius: 2px;
    }

    /* 落石 */
    .rock {
        position: absolute;
        width: 30px;
        height: 30px;
        background: gray;
        border-radius: 5px;
    }

    #info {
        position: absolute;
        top: 10px;
        width: 100%;
        font-size: 20px;
    }

    #winner {
        display: none;
        font-size: 40px;
        margin-top: 20vh;
    }

    #restart {
        display: none;
        padding: 12px 25px;
        background: #60a5fa;
        border-radius: 6px;
        cursor: pointer;
        border: none;
        font-size: 20px;
        color: black;
    }
</style>
</head>
<body>

<div id="game">
    <div id="info">
        <b>操作说明：</b><br>
        玩家1： A 左 | D 右 | W 跳 | F 发射子弹<br>
        玩家2： ← 左 | → 右 | ↑ 跳 | / 发射子弹
    </div>

    <div id="winner"></div>
    <button id="restart" onclick="restart()">重新开始</button>
</div>

<script>
const game = document.getElementById("game");
const winnerText = document.getElementById("winner");
const restartBtn = document.getElementById("restart");

let players = [
    { x: 200, y: 500, vx: 0, vy: 0, color: "cyan", alive: true },
    { x: 900, y: 500, vx: 0, vy: 0, color: "red", alive: true }
];

let keys = {};
let bullets = [];
let rocks = [];
let gravity = 0.4;
let ground = window.innerHeight - 80;

/* 创建玩家元素 */
players.forEach((p, i) => {
    p.el = document.createElement("div");
    p.el.className = "player";
    p.el.style.background = p.color;
    game.appendChild(p.el);
});

/* 键盘监听 */
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/* 发射子弹 */
function shoot(i) {
    if (!players[i].alive) return;

    let dir = i === 0 ?
        (keys["d"] ? 1 : keys["a"] ? -1 : 1) :
        (keys["ArrowRight"] ? 1 : keys["ArrowLeft"] ? -1 : -1);

    let b = {
        x: players[i].x + 10,
        y: players[i].y + 20,
        vx: dir * 8,
        owner: i
    };
    b.el = document.createElement("div");
    b.el.className = "bullet";
    game.appendChild(b.el);
    bullets.push(b);
}

/* 落石生成 */
function spawnRock() {
    let r = {
        x: Math.random() * window.innerWidth,
        y: -30,
        vy: Math.random() * 2 + 3
    };
    r.el = document.createElement("div");
    r.el.className = "rock";
    r.el.style.left = r.x + "px";
    game.appendChild(r.el);
    rocks.push(r);

    setTimeout(spawnRock, 1000 + Math.random() * 1000);
}
spawnRock();

/* 主循环 */
function loop() {
    players.forEach((p, i) => {
        if (!p.alive) return;

        // 控制
        if (i === 0) { // 玩家1: A D W F
            if (keys["a"]) p.vx = -4;
            else if (keys["d"]) p.vx = 4;
            else p.vx = 0;
            if (keys["w"] && p.y >= ground) p.vy = -10;
            if (keys["f"]) { keys["f"] = false; shoot(0); }
        } else { // 玩家2: ← → ↑ /
            if (keys["ArrowLeft"]) p.vx = -4;
            else if (keys["ArrowRight"]) p.vx = 4;
            else p.vx = 0;
            if (keys["ArrowUp"] && p.y >= ground) p.vy = -10;
            if (keys["/"]) { keys["/"] = false; shoot(1); }
        }

        // 物理移动
        p.vy += gravity;
        p.y += p.vy;
        p.x += p.vx;

        if (p.y > ground) p.y = ground;
        if (p.x < 0) p.x = 0;
        if (p.x > window.innerWidth - 20) p.x = window.innerWidth - 20;

        p.el.style.left = p.x + "px";
        p.el.style.top = p.y + "px";
    });

    /* 子弹更新 */
    bullets.forEach((b, idx) => {
        b.x += b.vx;
        b.el.style.left = b.x + "px";
        b.el.style.top = b.y + "px";

        // 飞出屏幕
        if (b.x < 0 || b.x > window.innerWidth) {
            b.el.remove();
            bullets.splice(idx, 1);
        }

        // 检测击中
        players.forEach((p, i) => {
            if (!p.alive || b.owner === i) return;
            if (Math.abs(b.x - p.x) < 20 && Math.abs(b.y - p.y) < 50) {
                die(i);
            }
        });
    });

    /* 落石更新 */
    rocks.forEach((r, idx) => {
        r.y += r.vy;
        r.el.style.top = r.y + "px";

        // 砸中玩家
        players.forEach((p, i) => {
            if (!p.alive) return;
            if (Math.abs(r.x - p.x) < 20 && Math.abs(r.y - p.y) < 50) {
                die(i);
            }
        });

        if (r.y > window.innerHeight) {
            r.el.remove();
            rocks.splice(idx, 1);
        }
    });

    requestAnimationFrame(loop);
}
loop();

/* 玩家死亡 */
function die(i) {
    if (!players[i].alive) return;
    players[i].alive = false;
    players[i].el.style.opacity = "0.2";

    let winner = i === 0 ? "玩家2 获胜！" : "玩家1 获胜！";
    winnerText.innerHTML = winner;
    winnerText.style.display = "block";
    restartBtn.style.display = "inline-block";
}

/* 重新开始 */
function restart() {
    window.location.reload();
}
</script>

</body>
</html>
