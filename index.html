<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¢«å…¥ä¾µçš„ç”Ÿå­˜å°æ¸¸æˆ â€” Qç‰ˆå¡é€š</title>
<style>
    :root{
        --bg:#0b0f12;
        --accent:#00d1a6;
        --cute:#ffd57e;
        --slime:#7ce27c;
        --rock:#c6b89a;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family: "Segoe UI", Roboto, "Microsoft Yahei", sans-serif;color:#d7fff0;}
    canvas{display:block;}
    /* é¡¶å±‚æç¤º / å¼€å§‹ç•Œé¢ */
    #intro{
        position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;
        z-index:40;background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.85));
        gap:18px;padding:24px;text-align:center;
    }
    #intro .warning{
        color:var(--accent);font-weight:700;font-size:20px;text-shadow:0 0 8px rgba(0,209,166,0.2);
    }
    #intro .hacked{
        color:#ff6b6b;font-size:26px;font-weight:800;
        -webkit-text-stroke: 0.6px rgba(0,0,0,0.6);
        animation:flash 1s linear infinite;
    }
    @keyframes flash{0%{opacity:1}50%{opacity:0.25}100%{opacity:1}}
    #startBtn{
        background:linear-gradient(90deg, #ffd57e, #ff9f9f);border:none;padding:12px 20px;border-radius:999px;
        cursor:pointer;font-weight:700;font-size:18px;color:#2b2b2b;box-shadow:0 6px 18px rgba(0,0,0,0.45);
    }
    #controlHint{
        position:fixed;left:12px;top:12px;background:rgba(0,0,0,0.35);padding:8px 12px;border-radius:8px;
        color:#e8fff6;font-size:14px;z-index:30;border:1px solid rgba(255,255,255,0.04);
    }
    #hud{
        position:fixed;right:12px;top:12px;background:rgba(0,0,0,0.35);padding:8px 12px;border-radius:8px;color:#fff;font-size:14px;z-index:30;
    }
    /* å‡è“å± */
    #bluescreen{
        position:fixed;inset:0;background:#0a36ff;color:white;font-family: Consolas, monospace;display:none;z-index:60;padding:30px;
    }
    #bluescreen .big{font-size:72px;margin-bottom:12px}
    #bluescreen .desc{font-size:20px;opacity:0.95}
    #bluescreen button{margin-top:20px;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-size:16px}
    /* åº•éƒ¨å°æç¤º */
    #footerHint{position:fixed;left:50%;transform:translateX(-50%);bottom:10px;color:rgba(255,255,255,0.22);font-size:13px;z-index:20}
</style>
</head>
<body>

<!-- ä»£ç é›¨ç”»å¸ƒï¼ˆç”¨äºå¼€å§‹ç•Œé¢çš„è¢«å…¥ä¾µç‰¹æ•ˆï¼‰ -->
<canvas id="matrix" style="position:fixed;inset:0;z-index:20;pointer-events:none;"></canvas>

<!-- æ¸¸æˆç”»å¸ƒ -->
<canvas id="game"></canvas>

<!-- å¼€å§‹/å…¥ä¾µæç¤º -->
<div id="intro">
    <div class="warning">æ£€æµ‹åˆ°æœªæˆæƒè®¿é—® â€” ç³»ç»Ÿå®Œæ•´æ€§é­åˆ°ç ´å</div>
    <div class="hacked">!!! YOUR MACHINE IS COMPROMISED !!!</div>
    <div style="max-width:720px;color:#c6fff0;line-height:1.4">
        ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿï¼Œæˆ‘ä»¬ä¼šè¿›è¡Œç”Ÿå­˜éªŒè¯ã€‚
        <br>åœ¨è§„å®šæ—¶é—´å†…å­˜æ´»ï¼šé¿å…è¢«è¿½æ•çš„å²è±å§†æˆ–è¢«å¤©ç©ºæ‰è½çš„å²©çŸ³ç ¸ä¸­ã€‚
    </div>

    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:center;">
        <div style="background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;color:#bfffe8">
            æ§åˆ¶ï¼šW A S D æˆ– â†‘ â† â†“
        </div>
        <div style="background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:8px;color:#bfffe8">
            ç›®æ ‡ï¼šå°½å¯èƒ½é•¿æ—¶é—´ç”Ÿå­˜
        </div>
    </div>

    <button id="startBtn">å¼€å§‹ç”Ÿå­˜æŒ‘æˆ˜</button>
</div>

<!-- æ§åˆ¶æç¤ºï¼ˆæ¸¸æˆä¸­æ˜¾ç¤ºï¼‰ -->
<div id="controlHint">æ§åˆ¶ï¼šW A S D æˆ– â†‘ â† â†“</div>
<div id="hud">ç”Ÿå­˜ï¼š<span id="time">0.0</span>s</div>
<div id="footerHint">æœ¬é¡µé¢ä¸ºæ¨¡æ‹Ÿæ¶æè“å±ï¼Œè¯·å‹¿åœ¨çœŸå®ç³»ç»Ÿä¸Šæµ‹è¯•ã€‚</div>

<!-- å‡è“å± -->
<div id="bluescreen">
    <div class="big">:(</div>
    <div class="desc">ä½ çš„ç”µè„‘é‡åˆ°é—®é¢˜ï¼Œéœ€è¦é‡æ–°å¯åŠ¨ã€‚<br>é”™è¯¯ä»£ç ï¼šSYSTEM_HACKED_FATAL_ERROR</div>
    <div style="margin-top:16px">åŸå› ï¼šç©å®¶å·²æ­»äº¡ï¼ˆè¢«å²è±å§†è¿½ä¸Š æˆ– è¢«çŸ³å¤´ç ¸ä¸­ï¼‰</div>
    <button id="bsodBtn">æˆ‘è¢«æ‰å¼„äº† ğŸ˜ˆï¼ˆè¿”å›ï¼‰</button>
</div>

<script>
/* =========================
   åˆå§‹åŒ– & ç”»å¸ƒè‡ªé€‚åº”
   ========================= */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const matrixCanvas = document.getElementById('matrix');
const mctx = matrixCanvas.getContext('2d');
let DPR = window.devicePixelRatio || 1;

function resize() {
    DPR = window.devicePixelRatio || 1;
    canvas.width = Math.floor(window.innerWidth * DPR);
    canvas.height = Math.floor(window.innerHeight * DPR);
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);

    matrixCanvas.width = Math.floor(window.innerWidth * DPR);
    matrixCanvas.height = Math.floor(window.innerHeight * DPR);
    matrixCanvas.style.width = window.innerWidth + 'px';
    matrixCanvas.style.height = window.innerHeight + 'px';
    mctx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resize);
resize();

/* =========================
   è¢«å…¥ä¾µâ€œä»£ç é›¨ + è­¦å‘Šâ€ç‰¹æ•ˆï¼ˆä»…å¼€å§‹ç•Œé¢ï¼‰
   ========================= */
const chars = "01ã‚ã„ã†ãˆãŠABCDEF0123456789â–ˆâ–“â–’";
let columns = Math.floor(window.innerWidth / 18);
let drops = Array(columns).fill(0);

function initMatrix() {
    columns = Math.floor(window.innerWidth / 18);
    drops = Array(columns).fill(0);
}
initMatrix();

function drawMatrix() {
    // èƒŒæ™¯åŠé€æ˜ï¼Œäº§ç”Ÿæ‹–å½±
    mctx.fillStyle = 'rgba(0,0,0,0.06)';
    mctx.fillRect(0,0, window.innerWidth, window.innerHeight);

    mctx.font = '14px monospace';
    for (let i = 0; i < drops.length; i++) {
        const text = chars[Math.floor(Math.random()*chars.length)];
        const x = i * 18;
        const y = drops[i] * 18;
        // å‰åŠæ®µç»¿è‰²ï¼ŒååŠæ®µäº®ç»¿
        mctx.fillStyle = Math.random() > 0.85 ? '#00ffb6' : '#00d1a6';
        mctx.fillText(text, x, y);
        drops[i]++;
        if (drops[i] * 18 > window.innerHeight && Math.random() > 0.975) drops[i] = 0;
    }
}
let matrixInterval;
function startMatrix() {
    if (matrixInterval) clearInterval(matrixInterval);
    matrixInterval = setInterval(drawMatrix, 60);
}
function stopMatrix() {
    if (matrixInterval) clearInterval(matrixInterval);
}

/* =========================
   æ¸¸æˆå¯¹è±¡ï¼ˆQç‰ˆå¡é€šé£ï¼‰
   - ç©å®¶ï¼šåœ†å¤´åœ†è„¸ï¼Œå¸¦çœ¼ç›å’Œå°ç¬‘è„¸
   - å²è±å§†ï¼ˆè™«å­ï¼‰ï¼šåœ†æ¶¦ã€æ³¢åŠ¨ï¼Œå¸¦çœ¼ç›
   - çŸ³å¤´ï¼šæœ‰è¡¨æƒ…çš„å¯çˆ±å²©çŸ³
   ========================= */
let state = 'intro'; // intro | running | dead

const player = {
    x: 160, y: 160, r: 18,
    speed: 3.6,
    bob: 0
};
const slime = {
    x: 60, y: 60, r: 22,
    speed: 1.6,
    wobble: 0
};
let stones = []; // {x,y,r,vy,faceOffset}

let keys = {};
let startTime = 0;
let elapsed = 0;
let spawnTimer = 0;
let survival = 0;

/* ===== è¾“å…¥ ===== */
window.addEventListener('keydown', e => {
    keys[e.key] = true;
    // å…è®¸å¼€å§‹ç•Œé¢ç”¨é”®ç›˜å¼€å§‹
    if (state === 'intro' && (e.key === 'Enter' || e.key === ' ')) {
        document.getElementById('startBtn').click();
    }
});
window.addEventListener('keyup', e => keys[e.key] = false);

/* =========================
   ç»˜åˆ¶è¾…åŠ©ï¼šè½¯é˜´å½±ã€å¡é€šé£æ ¼è„¸
   ========================= */
function drawRoundRect(x,y,w,h,radius,fillStyle,strokeStyle){
    ctx.beginPath();
    ctx.moveTo(x+radius,y);
    ctx.arcTo(x+w,y,x+w,y+h,radius);
    ctx.arcTo(x+w,y+h,x,y+h,radius);
    ctx.arcTo(x,y+h,x,y,radius);
    ctx.arcTo(x,y,x+w,y,radius);
    if(fillStyle){ ctx.fillStyle = fillStyle; ctx.fill(); }
    if(strokeStyle){ ctx.strokeStyle = strokeStyle; ctx.stroke(); }
}

function drawPlayer(p){
    // shadow
    ctx.save();
    ctx.translate(p.x, p.y);
    // bobbing for walk feel
    const bob = Math.sin(p.bob) * 3;
    ctx.translate(0, bob);
    // body
    ctx.fillStyle = "#ffd57e";
    ctx.beginPath();
    ctx.arc(0, 0, p.r, 0, Math.PI*2);
    ctx.fill();
    // cheek blush
    ctx.fillStyle = "rgba(255,120,120,0.18)";
    ctx.beginPath();
    ctx.arc(-6, 4, 5, 0, Math.PI*2); ctx.fill();
    ctx.beginPath();
    ctx.arc(6, 4, 5, 0, Math.PI*2); ctx.fill();
    // eyes
    ctx.fillStyle = "#2b2b2b";
    ctx.beginPath(); ctx.arc(-6,-2,3,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(6,-2,3,0,Math.PI*2); ctx.fill();
    // mouth
    ctx.strokeStyle = "#2b2b2b";
    ctx.lineWidth = 2;
    ctx.beginPath(); ctx.arc(0,6,6,0,Math.PI); ctx.stroke();
    ctx.restore();
}

function drawSlime(s){
    ctx.save();
    ctx.translate(s.x, s.y);
    const wob = Math.sin(s.wobble) * 3;
    ctx.translate(0, wob);
    // body blob
    ctx.fillStyle = "#7ce27c";
    ctx.beginPath();
    ctx.moveTo(-s.r,0);
    ctx.quadraticCurveTo(-s.r, -s.r, 0, -s.r*1.1);
    ctx.quadraticCurveTo(s.r, -s.r, s.r, 0);
    ctx.quadraticCurveTo(s.r*0.6, s.r*0.9, s.r*0.2, s.r*0.8);
    ctx.quadraticCurveTo(0, s.r*0.95, -s.r*0.2, s.r*0.8);
    ctx.quadraticCurveTo(-s.r*0.6, s.r*0.9, -s.r,0);
    ctx.fill();
    // eyes
    ctx.fillStyle = "#222";
    ctx.beginPath(); ctx.arc(-7,-3,3,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(7,-3,3,0,Math.PI*2); ctx.fill();
    ctx.fillStyle = "#fff";
    ctx.beginPath(); ctx.arc(-6.2,-3.5,1,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(6.8,-3.5,1,0,Math.PI*2); ctx.fill();
    // cute mouth (small)
    ctx.strokeStyle = "#222"; ctx.lineWidth = 1.6;
    ctx.beginPath(); ctx.arc(0,6,5,0,Math.PI); ctx.stroke();
    ctx.restore();
}

function drawStone(st){
    ctx.save();
    ctx.translate(st.x, st.y);
    // rock main rounded
    ctx.fillStyle = "#c6b89a";
    ctx.beginPath();
    ctx.moveTo(-st.r,0);
    ctx.quadraticCurveTo(-st.r, -st.r*0.6, 0, -st.r);
    ctx.quadraticCurveTo(st.r, -st.r*0.4, st.r,0);
    ctx.quadraticCurveTo(st.r*0.4, st.r*0.8, 0, st.r*0.9);
    ctx.quadraticCurveTo(-st.r*0.4, st.r*0.8, -st.r,0);
    ctx.fill();
    // little cracks
    ctx.strokeStyle = '#a89373'; ctx.lineWidth=1.2;
    ctx.beginPath(); ctx.moveTo(-st.r*0.2, -st.r*0.2); ctx.lineTo(st.r*0.1, -st.r*0.05); ctx.lineTo(-st.r*0.05, st.r*0.2); ctx.stroke();
    // face
    ctx.fillStyle = "#2b2b2b";
    ctx.beginPath(); ctx.arc(-6 + st.faceOffset, -2, 2,0,Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(6 + st.faceOffset, -2, 2,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle = "#2b2b2b"; ctx.lineWidth=1.4;
    ctx.beginPath(); ctx.moveTo(-4 + st.faceOffset,6); ctx.quadraticCurveTo(0 + st.faceOffset,9,4 + st.faceOffset,6); ctx.stroke();
    ctx.restore();
}

/* =========================
   æ¸¸æˆé€»è¾‘
   ========================= */
function resetGame() {
    player.x = window.innerWidth * 0.5;
    player.y = window.innerHeight * 0.6;
    slime.x = window.innerWidth * 0.2;
    slime.y = window.innerHeight * 0.2;
    stones = [];
    startTime = performance.now();
    spawnTimer = 0;
    elapsed = 0;
    survival = 0;
    alive = true;
}

let alive = true;

function update(dt){
    if (state !== 'running') return;

    // player movement
    let vx = 0, vy = 0;
    if (keys['w'] || keys['ArrowUp']) vy -= 1;
    if (keys['s'] || keys['ArrowDown']) vy += 1;
    if (keys['a'] || keys['ArrowLeft']) vx -= 1;
    if (keys['d'] || keys['ArrowRight']) vx += 1;
    // normalize
    if (vx !== 0 || vy !== 0) {
        const inv = player.speed / Math.hypot(vx, vy);
        player.x += vx * inv;
        player.y += vy * inv;
        player.bob += 0.18;
    } else {
        // idle gentle bob
        player.bob += 0.06;
    }

    // clamp to viewport
    player.x = Math.max(30, Math.min(window.innerWidth-30, player.x));
    player.y = Math.max(30, Math.min(window.innerHeight-30, player.y));

    // slime AI: move toward player with slight random jitter and speed increase over time
    const dx = player.x - slime.x;
    const dy = player.y - slime.y;
    const dist = Math.hypot(dx,dy) || 1;
    // slime speed slowly ramps up (makes game get harder)
    const timeFactor = Math.min(1.6, 1 + (performance.now() - startTime)/45000);
    slime.wobble += 0.12;
    const sspd = slime.speed * timeFactor;
    slime.x += (dx / dist) * sspd + (Math.sin(performance.now()/300) * 0.3);
    slime.y += (dy / dist) * sspd + (Math.cos(performance.now()/290) * 0.3);

    // spawn stones occasionally, frequency increases slowly
    spawnTimer += dt;
    const spawnInterval = Math.max(400, 1200 - (performance.now() - startTime)/40); // ms
    if (spawnTimer > spawnInterval) {
        spawnTimer = 0;
        const rx = Math.random() * window.innerWidth;
        const r = 12 + Math.random() * 10;
        stones.push({x: rx, y: -40, r: r, vy: 3 + Math.random()*2, faceOffset: (Math.random()*6-3)});
    }

    // update stones
    for (let i = stones.length-1; i>=0; i--) {
        const s = stones[i];
        s.y += s.vy + (Math.sin(performance.now()/600 + i) * 0.3);
        // simple rotation-like face oscillation
        s.faceOffset = Math.sin((performance.now()/300 + i) / 100) * 3;
        // remove if offscreen
        if (s.y - s.r > window.innerHeight + 80) stones.splice(i,1);
    }

    // collisions: slime touches player?
    const dd = Math.hypot(player.x - slime.x, player.y - slime.y);
    if (dd < player.r + slime.r * 0.75) {
        // die
        onDeath('slime');
    }

    // stone collision: approximate bounding boxes
    for (let i = 0; i < stones.length; i++){
        const s = stones[i];
        if (Math.abs(player.x - s.x) < player.r + s.r*0.6 &&
            Math.abs(player.y - s.y) < player.r + s.r*0.6) {
            onDeath('stone');
            break;
        }
    }
    // update survival time
    elapsed = (performance.now() - startTime) / 1000;
    survival = elapsed;
    document.getElementById('time').textContent = survival.toFixed(1);
}

/* =========================
   æ¸²æŸ“
   ========================= */
function render(){
    // background: soft gradient
    ctx.clearRect(0,0,canvas.width, canvas.height);
    // fill with slight gradient for cute vibe
    const g = ctx.createLinearGradient(0,0,0,window.innerHeight);
    g.addColorStop(0, "#081017");
    g.addColorStop(1, "#09121a");
    ctx.fillStyle = g;
    ctx.fillRect(0,0,window.innerWidth, window.innerHeight);

    // subtle ground shadow
    ctx.fillStyle = "rgba(0,0,0,0.12)";
    ctx.fillRect(0, window.innerHeight - 70, window.innerWidth, 70);

    // stones (behind player sometimes)
    for (let s of stones) {
        drawStone(s);
    }

    // draw slime (behind slightly)
    drawSlime(slime);

    // draw player on top
    drawPlayer(player);

    // cute HUD: small hearts? we have only survival/time displayed separately
}

/* =========================
   æ­»äº¡ä¸è“å±
   ========================= */
function onDeath(by){
    if (state !== 'running') return;
    state = 'dead';
    alive = false;
    // small effect: flash screen
    const flash = document.createElement('div');
    flash.style.position = 'fixed'; flash.style.inset = '0'; flash.style.zIndex = 50;
    flash.style.background = 'rgba(255,255,255,0.12)'; document.body.appendChild(flash);
    setTimeout(()=>{ document.body.removeChild(flash); }, 160);
    // show fake bluescreen after short delay
    setTimeout(()=>{
        document.getElementById('bluescreen').style.display = 'block';
        // stop matrix
        stopMatrix();
    }, 700);
}

/* =========================
   ä¸»å¾ªç¯ï¼ˆæ—¶é—´é©±åŠ¨ï¼‰
   ========================= */
let last = performance.now();
function loop(now){
    const dt = now - last;
    last = now;
    if (state === 'intro') {
        // draw matrix overlay (start screen)
        // matrix drawn separately via interval
    } else if (state === 'running') {
        update(dt);
        render();
    } else if (state === 'dead') {
        // freeze, maybe animate small death particle - keep canvas as is
    }
    requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

/* =========================
   äº¤äº’ï¼šå¼€å§‹æŒ‰é’®ã€è“å±æŒ‰é’®
   ========================= */
document.getElementById('startBtn').addEventListener('click', ()=>{
    // hide intro, start game
    document.getElementById('intro').style.display = 'none';
    startMatrix(); // keep code rain subtle in background while playing
    state = 'running';
    resetGame();
    startTime = performance.now();
    last = performance.now();
});

document.getElementById('bsodBtn').addEventListener('click', ()=>{
    alert('ä½ è¢«æ‰å¼„å•¦ ğŸ˜†ï¼ï¼ˆè¿”å›é¡µé¢ï¼‰');
    // reload to restart
    location.reload();
});

/* ensure matrix runs only on intro initially */
startMatrix();

/* when window resized, reinit matrix */
window.addEventListener('resize', ()=>{
    initMatrix();
    resize();
});

/* Prevent accidental text selection with keys */
window.addEventListener('keydown', function(e){
    if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight',' '].includes(e.key)) e.preventDefault();
});
</script>
</body>
</html>
